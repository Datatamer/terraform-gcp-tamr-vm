  configBucket: ${var.tamr_dataproc_bucket}
  gceClusterConfig:
    zoneUri: us-east1-b
    subnetworkUri: ${var.subnetwork_uri}
    internalIpOnly: true
    serviceAccount: ${var.service_account}
    # need to figure out how to productionize this patch
    metadata:
      gcs-connector-url: gs://${var.tamr_dataproc_bucket}/jars/java-nio-pipe-gcs-connector-hadoop2-2.2.0-SNAPSHOT-shaded.jar
  initializationActions:
    # see https://github.com/GoogleCloudDataproc/initialization-actions/tree/master/connectors
    # TODO: pin versions
    - executableFile: gs://goog-dataproc-initialization-actions-us-east1/connectors/connectors.sh
      executionTimeout: 500s
  softwareConfig:
    imageVersion: 1.3
    properties:
      dataproc:job.history.to-gcs.enabled: true
      dataproc:dataproc.logging.stackdriver.enable: ${var.stackdriver_logging}
      dataproc:dataproc.logging.stackdriver.job.driver.enable: ${var.stackdriver_logging}
      dataproc:dataproc.logging.stackdriver.job.yarn.container.enable: ${var.stackdriver_logging}
      core:fs.gs.outputstream.type: FLUSHABLE_COMPOSITE
      core:fs.gs.outputstream.sync.min.interval.ms: 1500
      core:fs.gs.outputstream.pipe.type: NIO_CHANNEL_PIPE
  masterConfig:
    numInstances: 1
    machineTypeUri: ${var.tamr_dataproc_cluster_master_instance_type}
    instanceNames:
      - ephemeral-master
    diskConfig:
      bootDiskType: pd-standard
      bootDiskSizeGb: ${var.tamr_dataproc_cluster_master_disk_size}
  workerConfig:
    numInstances: ${var.tamr_dataproc_cluster_worker_num_instances}
    machineTypeUri: ${var.tamr_dataproc_cluster_worker_machine_type}
    diskConfig:
      bootDiskType: pd-ssd
      bootDiskSizeGb: 100
      numLocalSsds: ${var.tamr_dataproc_cluster_worker_num_local_ssds}
  secondaryWorkerConfig:
    isPreemptible: true
    numInstances: ${var.tamr_dataproc_cluster_worker_preemptible_num_instances}
    machineTypeUri: ${var.tamr_dataproc_cluster_worker_preemptible_machine_type}
    diskConfig:
      bootDiskType: pd-ssd
      bootDiskSizeGb: 100
      numLocalSsds: ${var.tamr_dataproc_cluster_worker_preemptible_num_local_ssds}
